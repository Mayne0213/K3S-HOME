apiVersion: v1
kind: ConfigMap
metadata:
  name: haproxy-config
  namespace: haproxy
data:
  haproxy.cfg: |
    global
        log stdout format raw local0
        maxconn 4096

    defaults
        log global
        option tcplog
        timeout connect 10s
        timeout client 30s
        timeout server 30s

    # HTTP frontend - PROXY Protocol to Traefik
    frontend http_front
        bind *:80
        mode tcp
        default_backend traefik_http

    # HTTPS frontend - PROXY Protocol to Traefik
    frontend https_front
        bind *:443
        mode tcp
        default_backend traefik_https

    # HTTP backend - send PROXY Protocol v2
    backend traefik_http
        mode tcp
        balance roundrobin
        server traefik traefik.kube-system.svc.cluster.local:80 send-proxy-v2 check

    # HTTPS backend - send PROXY Protocol v2
    backend traefik_https
        mode tcp
        balance roundrobin
        server traefik traefik.kube-system.svc.cluster.local:443 send-proxy-v2 check
